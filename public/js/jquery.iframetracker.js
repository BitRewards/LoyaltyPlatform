/*
 © 2013-2015 Vincent Paré
 @license http://opensource.org/licenses/Apache-2.0
 @version 1.1.0
*/
(function(b){b.fn.iframeTracker=function(a){var c=this.get();if(null===a||!1===a)b.iframeTracker.untrack(c);else if("object"==typeof a)b.iframeTracker.track(c,a);else throw Error("Wrong handler type (must be an object, or null|false to untrack)");};b.iframeTracker={focusRetriever:null,focusRetrieved:!1,handlersList:[],isIE8AndOlder:!1,init:function(){try{1==b.browser.msie&&9>b.browser.version&&(this.isIE8AndOlder=!0)}catch(a){try{9>navigator.userAgent.match(/(msie) ([\w.]+)/i)[2]&&(this.isIE8AndOlder=
    !0)}catch(c){}}b(window).focus();b(window).blur(function(a){b.iframeTracker.windowLoseFocus(a)});b("body").append('<div style="position:fixed; top:0; left:0; overflow:hidden;"><input style="position:absolute; left:-300px;" type="text" value="" id="focus_retriever" readonly="true" /></div>');this.focusRetriever=b("#focus_retriever");this.focusRetrieved=!1;b(document).mousemove(function(a){document.activeElement&&"IFRAME"==document.activeElement.tagName&&(b.iframeTracker.focusRetriever.focus(),b.iframeTracker.focusRetrieved=
    !0)});if(this.isIE8AndOlder){this.focusRetriever.blur(function(a){a.stopPropagation();a.preventDefault();b.iframeTracker.windowLoseFocus(a)});b("body").click(function(a){b(window).focus()});b("form").click(function(a){a.stopPropagation()});try{b("body").on("click","form",function(a){a.stopPropagation()})}catch(a){console.log("[iframeTracker] Please update jQuery to 1.7 or newer. (exception: "+a.message+")")}}},track:function(a,c){c.target=a;b.iframeTracker.handlersList.push(c);b(a).bind("mouseover",
    {handler:c},b.iframeTracker.mouseoverListener).bind("mouseout",{handler:c},b.iframeTracker.mouseoutListener)},untrack:function(a){if("function"!=typeof Array.prototype.filter)console.log("Your browser doesn't support Array filter, untrack disabled");else{b(a).each(function(a){b(this).unbind("mouseover",b.iframeTracker.mouseoverListener).unbind("mouseout",b.iframeTracker.mouseoutListener)});var c=function(a){return null===a?!1:!0},d;for(d in this.handlersList){for(var e in this.handlersList[d].target)-1!==
b.inArray(this.handlersList[d].target[e],a)&&(this.handlersList[d].target[e]=null);this.handlersList[d].target=this.handlersList[d].target.filter(c);0==this.handlersList[d].target.length&&(this.handlersList[d]=null)}this.handlersList=this.handlersList.filter(c)}},mouseoverListener:function(a){a.data.handler.over=!0;try{a.data.handler.overCallback(this)}catch(c){}},mouseoutListener:function(a){a.data.handler.over=!1;b.iframeTracker.focusRetriever.focus();try{a.data.handler.outCallback(this)}catch(c){}},
    windowLoseFocus:function(a){for(var b in this.handlersList)if(1==this.handlersList[b].over)try{this.handlersList[b].blurCallback()}catch(d){}}};b(document).ready(function(){b.iframeTracker.init()})})(jQuery);
